<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Party Vote</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
      padding: 20px;
    }
    button {
      padding: 15px;
      margin: 10px;
      font-size: 18px;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>

<h1>ðŸŽ‰ Party Vote ðŸŽ‰</h1>

<div id="roleScreen">
  <button onclick="setRole('master')">Quiz Master</button>
  <button onclick="setRole('player')">Player</button>
</div>

<div id="voteScreen" class="hidden">
  <h2>Vote what to do</h2>
  <button onclick="sendVote('Quiz')">Quiz</button>
  <button onclick="sendVote('Games')">Games</button>
  <button onclick="sendVote('Music')">Music</button>
  <p id="voteMsg"></p>
</div>

<div id="masterScreen" class="hidden">
  <h2>Live Results</h2>
  <div id="results">Waiting for votesâ€¦</div>
  <button onclick="endVoting()">TIMEâ€™S UP</button>
</div>

<script>
/* ðŸ”´ PUT YOUR /exec URL HERE ðŸ”´ */
const API_URL = "https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLgt08pCLYUrLaFRv-ehEfrma9chf3Sa6jvvtkHgGCB7j6HoEnxvoxh6mPVYD45DYjDO9R8nEo847zMxarp9GGSiRk60acKmldGDEyRhJG7O4VsvK_0YSUasFkbmsG3tt8EfEBdQXMuuIBltgK_bdKz7ZdSjDGdy2ReSFy4sAfH6mUwRDWHZJPypmT69EVbxoahE71YlGSgFEr4rDA3xREll6MrjXCuagSD1D2Uozo3m0mfTHk7newDsxfES7tYa3NkZOwlorKoy230o2HcvvkLg1nrUbeOCiMmANOGv&lib=MPKv64G8uSqh63gOMII5c4Ng4AQptJ_cO";

/* role selection */
function setRole(role) {
  localStorage.setItem("role", role);
  document.getElementById("roleScreen").classList.add("hidden");
  document.getElementById("voteScreen").classList.remove("hidden");

  if (role === "master") {
    document.getElementById("masterScreen").classList.remove("hidden");
  }
}

/* send vote */
function sendVote(option) {
  if (localStorage.getItem("voted")) {
    document.getElementById("voteMsg").innerText = "You already voted";
    return;
  }

  fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      type: "vote",
      option: option
    })
  });

  localStorage.setItem("voted", "true");
  document.getElementById("voteMsg").innerText = "Vote sent ðŸŽ‰";
}

/* end voting */
function endVoting() {
  fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      type: "setMode",
      mode: "quiz"
    })
  });
}

/* poll for live votes */
function poll() {
  fetch(API_URL)
    .then(response => response.json())
    .then(data => {
      let html = "";
      for (const key in data.votes) {
        html += `<p>${key}: ${data.votes[key]}</p>`;
      }
      document.getElementById("results").innerHTML = html || "No votes yet";
    })
    .catch(err => {
      document.getElementById("results").innerText = "API error";
      console.error(err);
    });
}

setInterval(poll, 2000);
</script>

</body>
</html>
